<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Browse Rooms – LocalRoom</title>
<style>
  body{font-family:sans-serif;background:#f4f6f8;margin:0;padding:0;}
  .listings-container{max-width:900px;margin:20px auto;padding:0 10px;}
  .room-card{background:white;border:1px solid #ddd;padding:15px;margin-bottom:20px;border-radius:8px;}
  .room-card img{max-width:100px;margin-right:5px;margin-bottom:5px;border-radius:5px;}
  input#filter{width:80%;max-width:400px;padding:10px;margin:20px auto;display:block;}
</style>
</head>
<body>

<input type="text" id="filter" placeholder="Search by location or title..." />
<div class="listings-container"></div>

<script type="module">
import { db, auth } from "./firebase-config.js";
import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const container = document.querySelector(".listings-container");
const filterInput = document.getElementById("filter");
let allRooms=[];

const displayRooms = (rooms) => {
  container.innerHTML="";
  if(rooms.length===0){ container.innerHTML="<p>No rooms found.</p>"; return; }
  rooms.forEach(room=>{
    const card=document.createElement("div");
    card.className="room-card";
    card.innerHTML=`
      <h3>${room.title}</h3>
      <p>${room.location} – R${room.price}/month</p>
      <div>${(room.images||[]).map(url=>`<img src="${url}" />`).join('')}</div>
    `;
    container.appendChild(card);
  });
};

const fetchRooms = async ()=>{
  try{
    const q=query(collection(db,"listings"),orderBy("createdAt","desc"));
    const snapshot=await getDocs(q);
    allRooms = snapshot.docs.map(d=>({id:d.id,...d.data()}));
    displayRooms(allRooms);
  }catch(err){ console.error(err); container.innerHTML="<p>Failed to load rooms.</p>"; }
};
filterInput.addEventListener("input",()=>{
  const val=filterInput.value.toLowerCase();
  displayRooms(allRooms.filter(r=>(r.title||"").toLowerCase().includes(val) || (r.location||"").toLowerCase().includes(val)));
});

fetchRooms();
</script>

</body>
</html>
